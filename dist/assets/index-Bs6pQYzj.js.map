{"version":3,"file":"index-Bs6pQYzj.js","sources":["../../src/scenes/MainMenuScene.js","../../src/entities/Character.js","../../src/scenes/GameWorldScene.js","../../src/scenes/DialogueScene.js","../../src/scenes/InventoryScene.js","../../src/systems/StorySystem.js","../../src/systems/PowerSystem.js","../../src/managers/GameManager.js","../../src/main.js","../../test-power-system.js"],"sourcesContent":["export default class MainMenuScene extends Phaser.Scene {\n    constructor() {\n        super({ key: 'MainMenuScene' });\n    }\n\n    preload() {\n        // Create simple colored rectangles as placeholder UI elements\n        this.load.image('menu-bg', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==');\n        \n        // Create placeholder button graphics using canvas\n        this.load.image('button-bg', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==');\n    }\n\n    create() {\n        // Add background\n        this.add.rectangle(400, 300, 800, 600, 0x2c3e50);\n        \n        // Add game title\n        this.add.text(400, 150, 'Top-Down Web RPG', {\n            fontSize: '48px',\n            fontFamily: 'Arial',\n            color: '#ecf0f1',\n            fontStyle: 'bold'\n        }).setOrigin(0.5);\n\n        // Add subtitle\n        this.add.text(400, 200, 'A Story-Driven Adventure', {\n            fontSize: '20px',\n            fontFamily: 'Arial',\n            color: '#bdc3c7'\n        }).setOrigin(0.5);\n\n        // Create \"Start New Adventure\" button\n        const startButton = this.add.rectangle(400, 300, 300, 60, 0x3498db);\n        startButton.setStroke(2, 0x2980b9);\n        \n        const startButtonText = this.add.text(400, 300, 'Start New Adventure', {\n            fontSize: '20px',\n            fontFamily: 'Arial',\n            color: '#ffffff',\n            fontStyle: 'bold'\n        }).setOrigin(0.5);\n\n        // Make button interactive\n        startButton.setInteractive({ useHandCursor: true });\n        \n        // Button hover effects\n        startButton.on('pointerover', () => {\n            startButton.setFillStyle(0x2980b9);\n            startButtonText.setScale(1.05);\n        });\n        \n        startButton.on('pointerout', () => {\n            startButton.setFillStyle(0x3498db);\n            startButtonText.setScale(1);\n        });\n        \n        // Button click handler - transition to game world\n        startButton.on('pointerdown', () => {\n            this.startNewGame();\n        });\n\n        // Add keyboard support for starting game\n        this.input.keyboard.on('keydown-ENTER', () => {\n            this.startNewGame();\n        });\n\n        // Add instructions\n        this.add.text(400, 450, 'Press ENTER or click to start', {\n            fontSize: '16px',\n            fontFamily: 'Arial',\n            color: '#95a5a6'\n        }).setOrigin(0.5);\n    }\n\n    startNewGame() {\n        // Transition to GameWorldScene\n        this.scene.start('GameWorldScene');\n    }\n\n    update() {\n        // Main menu doesn't need continuous updates\n    }\n}","export default class Character {\n    constructor(scene, x, y) {\n        this.scene = scene;\n        this.tileSize = 32;\n        \n        // Create the character sprite\n        this.sprite = this.scene.add.sprite(x, y, 'player-sprite');\n        this.sprite.setOrigin(0, 0);\n        \n        // Set initial depth based on Y position for proper layering\n        this.updateDepth();\n        \n        // Movement properties\n        this.speed = 120; // pixels per second\n        this.isMoving = false;\n        this.facingDirection = 'down';\n        \n        // Animation properties\n        this.animationTint = 0xffffff;\n        this.animationTimer = 0;\n        this.animationDuration = 200; // milliseconds\n        \n        // Store grid position for collision checking\n        this.gridX = Math.floor(x / this.tileSize);\n        this.gridY = Math.floor(y / this.tileSize);\n        \n        // Movement input state\n        this.inputState = {\n            up: false,\n            down: false,\n            left: false,\n            right: false\n        };\n    }\n\n    createPlaceholderSprite() {\n        // Create simple character sprite (blue square with white center)\n        const charGraphics = this.scene.add.graphics();\n        charGraphics.fillStyle(0x3498db);\n        charGraphics.fillRect(0, 0, this.tileSize, this.tileSize);\n        charGraphics.fillStyle(0xffffff);\n        charGraphics.fillCircle(this.tileSize/2, this.tileSize/2, 8);\n        charGraphics.generateTexture('player-sprite', this.tileSize, this.tileSize);\n        charGraphics.destroy();\n    }\n\n    update(time, delta) {\n        this.handleMovement(delta);\n        this.updateAnimation(time, delta);\n    }\n\n    handleMovement(delta) {\n        let velocityX = 0;\n        let velocityY = 0;\n        let newFacingDirection = this.facingDirection;\n\n        // Calculate movement based on input\n        if (this.inputState.left) {\n            velocityX = -this.speed;\n            newFacingDirection = 'left';\n        } else if (this.inputState.right) {\n            velocityX = this.speed;\n            newFacingDirection = 'right';\n        }\n\n        if (this.inputState.up) {\n            velocityY = -this.speed;\n            newFacingDirection = 'up';\n        } else if (this.inputState.down) {\n            velocityY = this.speed;\n            newFacingDirection = 'down';\n        }\n\n        // Normalize diagonal movement\n        if (velocityX !== 0 && velocityY !== 0) {\n            velocityX *= 0.707; // 1/sqrt(2)\n            velocityY *= 0.707;\n        }\n\n        // Update facing direction\n        if (velocityX !== 0 || velocityY !== 0) {\n            this.facingDirection = newFacingDirection;\n            this.isMoving = true;\n        } else {\n            this.isMoving = false;\n        }\n\n        // Calculate new position\n        const deltaSeconds = delta / 1000;\n        let newX = this.sprite.x + (velocityX * deltaSeconds);\n        let newY = this.sprite.y + (velocityY * deltaSeconds);\n\n        // Check collision boundaries\n        const collision = this.checkCollision(newX, newY);\n        \n        if (!collision.x) {\n            this.sprite.x = newX;\n            this.gridX = Math.floor(this.sprite.x / this.tileSize);\n        }\n        \n        if (!collision.y) {\n            this.sprite.y = newY;\n            this.gridY = Math.floor(this.sprite.y / this.tileSize);\n            // Update depth when Y position changes for proper layering\n            this.updateDepth();\n        }\n    }\n\n    checkCollision(newX, newY) {\n        const worldBounds = this.scene.getWorldBounds();\n        const collision = { x: false, y: false };\n\n        // Check world boundaries\n        if (newX < 0 || newX >= worldBounds.width - this.tileSize) {\n            collision.x = true;\n        }\n        \n        if (newY < 0 || newY >= worldBounds.height - this.tileSize) {\n            collision.y = true;\n        }\n\n        // Check tile-based collisions (water, trees, stones)\n        const gridX = Math.floor(newX / this.tileSize);\n        const gridY = Math.floor(newY / this.tileSize);\n        \n        if (this.scene.isCollisionTile && this.scene.isCollisionTile(gridX, gridY)) {\n            // Determine which axis to block based on movement direction\n            if (Math.abs(newX - this.sprite.x) > Math.abs(newY - this.sprite.y)) {\n                collision.x = true;\n            } else {\n                collision.y = true;\n            }\n        }\n\n        return collision;\n    }\n\n    updateAnimation(time, delta) {\n        if (this.isMoving) {\n            // Simple animation using tint changes\n            this.animationTimer += delta;\n            \n            if (this.animationTimer >= this.animationDuration) {\n                this.animationTimer = 0;\n                \n                // Cycle through different tints to simulate movement\n                const tints = [0xffffff, 0xe8f4f8, 0xd1e9f2, 0xe8f4f8];\n                const currentTintIndex = Math.floor(time / this.animationDuration) % tints.length;\n                this.sprite.setTint(tints[currentTintIndex]);\n            }\n        } else {\n            // Reset to normal tint when not moving\n            this.sprite.setTint(0xffffff);\n            this.animationTimer = 0;\n        }\n\n        // Add subtle directional visual feedback\n        this.updateDirectionalVisual();\n    }\n\n    updateDirectionalVisual() {\n        // Slightly adjust sprite position or rotation based on facing direction\n        // This provides visual feedback for the direction the character is facing\n        switch (this.facingDirection) {\n            case 'up':\n                this.sprite.setScale(1, 0.95);\n                break;\n            case 'down':\n                this.sprite.setScale(1, 1.05);\n                break;\n            case 'left':\n                this.sprite.setScale(0.95, 1);\n                break;\n            case 'right':\n                this.sprite.setScale(1.05, 1);\n                break;\n            default:\n                this.sprite.setScale(1, 1);\n        }\n    }\n\n    updateDepth() {\n        // Set depth based on Y position for proper layering with world objects\n        // Objects lower on screen (higher Y values) should appear in front\n        this.sprite.setDepth(this.sprite.y + this.tileSize);\n    }\n\n    // Input handling methods\n    setInputState(direction, isPressed) {\n        if (this.inputState.hasOwnProperty(direction)) {\n            this.inputState[direction] = isPressed;\n        }\n    }\n\n    // Utility methods\n    getPosition() {\n        return { x: this.sprite.x, y: this.sprite.y };\n    }\n\n    getGridPosition() {\n        return { x: this.gridX, y: this.gridY };\n    }\n\n    setPosition(x, y) {\n        this.sprite.x = x;\n        this.sprite.y = y;\n        this.gridX = Math.floor(x / this.tileSize);\n        this.gridY = Math.floor(y / this.tileSize);\n    }\n\n    getFacingDirection() {\n        return this.facingDirection;\n    }\n\n    isCharacterMoving() {\n        return this.isMoving;\n    }\n\n    /**\n     * Use a power through the power system\n     * @param {string} powerId - ID of the power to use\n     * @param {Object} context - Additional context for power usage\n     * @returns {boolean} - Whether power was successfully used\n     */\n    usePower(powerId, context = {}) {\n        // Get power system from GameManager\n        const gameManager = this.scene.plugins.get('GameManager');\n        if (!gameManager || !gameManager.getPowerSystem()) {\n            console.warn('Power system not available');\n            return false;\n        }\n\n        const powerSystem = gameManager.getPowerSystem();\n        \n        // Add character context to power usage\n        const powerContext = {\n            ...context,\n            character: this,\n            position: this.getPosition(),\n            gridPosition: this.getGridPosition(),\n            facingDirection: this.facingDirection\n        };\n\n        return powerSystem.activatePower(powerId, powerContext);\n    }\n\n    /**\n     * Check if character can use a specific power\n     * @param {string} powerId - ID of the power to check\n     * @returns {boolean} - Whether power can be used\n     */\n    canUsePower(powerId) {\n        const gameManager = this.scene.plugins.get('GameManager');\n        if (!gameManager || !gameManager.getPowerSystem()) {\n            return false;\n        }\n\n        const powerSystem = gameManager.getPowerSystem();\n        return powerSystem.checkPowerAvailability(powerId);\n    }\n\n    /**\n     * Get list of unlocked powers for this character\n     * @returns {Array} - Array of unlocked power objects\n     */\n    getUnlockedPowers() {\n        const gameManager = this.scene.plugins.get('GameManager');\n        if (!gameManager || !gameManager.getPowerSystem()) {\n            return [];\n        }\n\n        const powerSystem = gameManager.getPowerSystem();\n        return powerSystem.getUnlockedPowerList();\n    }\n\n    // Method for future interaction system\n    interact(target) {\n        // Placeholder for interaction system - will be implemented in later tasks\n        console.log(`Character interacting with:`, target);\n    }\n\n    destroy() {\n        if (this.sprite) {\n            this.sprite.destroy();\n        }\n    }\n}","import Character from '../entities/Character.js';\n\nexport default class GameWorldScene extends Phaser.Scene {\n    constructor() {\n        super({ key: 'GameWorldScene' });\n        this.tileSize = 32;\n        this.worldWidth = 25;\n        this.worldHeight = 19;\n        this.worldData = null;\n    }\n\n    preload() {\n        // Create placeholder tile graphics using canvas\n        this.createPlaceholderTiles();\n        \n        // Create placeholder character sprite\n        this.createPlaceholderCharacter();\n    }\n\n    createPlaceholderTiles() {\n        // Create grass tile (green)\n        const grassGraphics = this.add.graphics();\n        grassGraphics.fillStyle(0x27ae60);\n        grassGraphics.fillRect(0, 0, this.tileSize, this.tileSize);\n        grassGraphics.generateTexture('grass-tile', this.tileSize, this.tileSize);\n        grassGraphics.destroy();\n\n        // Create stone tile (gray)\n        const stoneGraphics = this.add.graphics();\n        stoneGraphics.fillStyle(0x7f8c8d);\n        stoneGraphics.fillRect(0, 0, this.tileSize, this.tileSize);\n        stoneGraphics.lineStyle(1, 0x95a5a6);\n        stoneGraphics.strokeRect(0, 0, this.tileSize, this.tileSize);\n        stoneGraphics.generateTexture('stone-tile', this.tileSize, this.tileSize);\n        stoneGraphics.destroy();\n\n        // Create water tile (blue)\n        const waterGraphics = this.add.graphics();\n        waterGraphics.fillStyle(0x3498db);\n        waterGraphics.fillRect(0, 0, this.tileSize, this.tileSize);\n        waterGraphics.generateTexture('water-tile', this.tileSize, this.tileSize);\n        waterGraphics.destroy();\n\n        // Create tree tile (dark green)\n        const treeGraphics = this.add.graphics();\n        treeGraphics.fillStyle(0x27ae60);\n        treeGraphics.fillRect(0, 0, this.tileSize, this.tileSize);\n        treeGraphics.fillStyle(0x1e8449);\n        treeGraphics.fillCircle(this.tileSize/2, this.tileSize/2, this.tileSize/3);\n        treeGraphics.generateTexture('tree-tile', this.tileSize, this.tileSize);\n        treeGraphics.destroy();\n    }\n\n    createPlaceholderCharacter() {\n        // Create simple character sprite (blue square with white center)\n        const charGraphics = this.add.graphics();\n        charGraphics.fillStyle(0x3498db);\n        charGraphics.fillRect(0, 0, this.tileSize, this.tileSize);\n        charGraphics.fillStyle(0xffffff);\n        charGraphics.fillCircle(this.tileSize/2, this.tileSize/2, 8);\n        charGraphics.generateTexture('player-sprite', this.tileSize, this.tileSize);\n        charGraphics.destroy();\n    }\n\n    create() {\n        // Create the world map\n        this.createWorld();\n        \n        // Create player character\n        this.createPlayer();\n        \n        // Set up camera to follow player\n        this.setupCamera();\n        \n        // Set up input controls\n        this.setupControls();\n        \n        // Add UI elements\n        this.createUI();\n        \n        // Initialize story system integration\n        this.initializeStorySystem();\n        \n        // Set up scene event handlers\n        this.setupSceneEvents();\n    }\n\n    createWorld() {\n        // Create a simple world layout\n        this.worldData = this.generateWorldData();\n        \n        // Create separate groups for different layers to control depth rendering\n        this.backgroundLayer = this.add.group(); // Ground tiles (grass, stone, water)\n        this.objectLayer = this.add.group();     // Objects that can be behind or in front of player\n        this.foregroundLayer = this.add.group(); // Objects that are always in front of player\n        \n        // Render the world tiles with proper layering\n        for (let y = 0; y < this.worldHeight; y++) {\n            for (let x = 0; x < this.worldWidth; x++) {\n                const tileType = this.worldData[y][x];\n                const tileX = x * this.tileSize;\n                const tileY = y * this.tileSize;\n                \n                let tileSprite;\n                let targetLayer = this.backgroundLayer;\n                \n                switch (tileType) {\n                    case 'grass':\n                        tileSprite = this.add.image(tileX, tileY, 'grass-tile');\n                        break;\n                    case 'stone':\n                        tileSprite = this.add.image(tileX, tileY, 'stone-tile');\n                        break;\n                    case 'water':\n                        tileSprite = this.add.image(tileX, tileY, 'water-tile');\n                        break;\n                    case 'tree':\n                        tileSprite = this.add.image(tileX, tileY, 'tree-tile');\n                        targetLayer = this.objectLayer; // Trees can be behind or in front of player\n                        break;\n                    default:\n                        tileSprite = this.add.image(tileX, tileY, 'grass-tile');\n                }\n                \n                tileSprite.setOrigin(0, 0);\n                \n                // Set depth based on Y position for proper layering\n                tileSprite.setDepth(tileY + (tileType === 'tree' ? this.tileSize : 0));\n                \n                targetLayer.add(tileSprite);\n            }\n        }\n        \n        // Add area transition zones\n        this.createAreaTransitions();\n    }\n\n    generateWorldData() {\n        // Create a simple world pattern with clear boundaries\n        const world = [];\n        \n        for (let y = 0; y < this.worldHeight; y++) {\n            world[y] = [];\n            for (let x = 0; x < this.worldWidth; x++) {\n                // Create borders with stone (except at transition points)\n                if (x === 0 || x === this.worldWidth - 1 || y === 0 || y === this.worldHeight - 1) {\n                    // Leave gaps for area transitions\n                    if ((x === 12 && y === 0) || // North transition\n                        (x === this.worldWidth - 1 && y === 9) || // East transition  \n                        (x === 12 && y === this.worldHeight - 1)) { // South transition\n                        world[y][x] = 'grass';\n                    } else {\n                        world[y][x] = 'stone';\n                    }\n                }\n                // Add some water patches\n                else if ((x >= 5 && x <= 7 && y >= 8 && y <= 10) || \n                         (x >= 15 && x <= 17 && y >= 4 && y <= 6)) {\n                    world[y][x] = 'water';\n                }\n                // Add some trees for depth testing\n                else if ((x + y) % 7 === 0 && Math.random() > 0.5) {\n                    world[y][x] = 'tree';\n                }\n                // Add some strategic trees near transition zones\n                else if ((x === 11 || x === 13) && (y === 1 || y === this.worldHeight - 2)) {\n                    world[y][x] = 'tree';\n                }\n                // Default to grass\n                else {\n                    world[y][x] = 'grass';\n                }\n            }\n        }\n        \n        return world;\n    }\n\n    createPlayer() {\n        // Place player in the center of the world\n        const startX = Math.floor(this.worldWidth / 2) * this.tileSize;\n        const startY = Math.floor(this.worldHeight / 2) * this.tileSize;\n        \n        // Create character using the new Character class\n        this.player = new Character(this, startX, startY);\n    }\n\n    setupCamera() {\n        // Set world bounds\n        this.cameras.main.setBounds(0, 0, this.worldWidth * this.tileSize, this.worldHeight * this.tileSize);\n        \n        // Make camera follow player sprite with smooth following\n        this.cameras.main.startFollow(this.player.sprite, true, 0.08, 0.08);\n        this.cameras.main.setZoom(1.5); // Slightly zoomed in for better view\n        \n        // Set camera deadzone for smoother following\n        this.cameras.main.setDeadzone(100, 100);\n        \n        // Enable camera bounds to prevent showing areas outside the world\n        this.cameras.main.useBounds = true;\n    }\n\n    setupControls() {\n        // Create cursor keys\n        this.cursors = this.input.keyboard.createCursorKeys();\n        \n        // Create WASD keys\n        this.wasd = this.input.keyboard.addKeys('W,S,A,D');\n        \n        // Add ESC key to return to menu\n        this.escKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ESC);\n    }\n\n    createUI() {\n        // Create UI elements that stay fixed on screen\n        this.uiContainer = this.add.container(0, 0);\n        this.uiContainer.setScrollFactor(0); // Keep UI fixed to camera\n        \n        // Add simple health indicator\n        const healthBg = this.add.rectangle(100, 30, 200, 20, 0x2c3e50);\n        healthBg.setStroke(2, 0x34495e);\n        const healthBar = this.add.rectangle(100, 30, 180, 16, 0xe74c3c);\n        \n        this.uiContainer.add([healthBg, healthBar]);\n        \n        // Add instructions\n        const instructions = this.add.text(10, 60, 'Use WASD or Arrow Keys to move\\nPress ESC to return to menu', {\n            fontSize: '14px',\n            fontFamily: 'Arial',\n            color: '#ecf0f1',\n            backgroundColor: 'rgba(0,0,0,0.5)',\n            padding: { x: 8, y: 4 }\n        });\n        this.uiContainer.add(instructions);\n    }\n\n    update(time, delta) {\n        // Update character with new input system\n        this.handleInput();\n        this.player.update(time, delta);\n        \n        // Update power system\n        if (this.powerSystem) {\n            this.powerSystem.update(time, delta);\n        }\n        \n        // Check for area transitions\n        this.checkAreaTransitions();\n        \n        // Handle story test controls\n        this.handleStoryTestControls();\n        \n        // Handle ESC key to return to menu\n        if (Phaser.Input.Keyboard.JustDown(this.escKey)) {\n            this.scene.start('MainMenuScene');\n        }\n    }\n\n    handleInput() {\n        // Update character input state based on keyboard input\n        this.player.setInputState('left', this.cursors.left.isDown || this.wasd.A.isDown);\n        this.player.setInputState('right', this.cursors.right.isDown || this.wasd.D.isDown);\n        this.player.setInputState('up', this.cursors.up.isDown || this.wasd.W.isDown);\n        this.player.setInputState('down', this.cursors.down.isDown || this.wasd.S.isDown);\n    }\n\n    // Methods for Character class collision detection\n    getWorldBounds() {\n        return {\n            width: this.worldWidth * this.tileSize,\n            height: this.worldHeight * this.tileSize\n        };\n    }\n\n    createAreaTransitions() {\n        // Create invisible transition zones at world edges for future area loading\n        this.transitionZones = this.add.group();\n        \n        // Create transition zones (invisible rectangles) at specific locations\n        // These will be used for area transitions in future story implementation\n        const transitionData = [\n            { x: 12 * this.tileSize, y: 0, width: this.tileSize, height: this.tileSize, direction: 'north', targetArea: 'forest_entrance' },\n            { x: 24 * this.tileSize, y: 9 * this.tileSize, width: this.tileSize, height: this.tileSize, direction: 'east', targetArea: 'village_outskirts' },\n            { x: 12 * this.tileSize, y: 18 * this.tileSize, width: this.tileSize, height: this.tileSize, direction: 'south', targetArea: 'cave_entrance' }\n        ];\n        \n        transitionData.forEach(zone => {\n            const transitionZone = this.add.zone(zone.x, zone.y, zone.width, zone.height);\n            transitionZone.setOrigin(0, 0);\n            transitionZone.setData('direction', zone.direction);\n            transitionZone.setData('targetArea', zone.targetArea);\n            \n            // Add visual indicator for transition zones (temporary for development)\n            const indicator = this.add.rectangle(zone.x + zone.width/2, zone.y + zone.height/2, zone.width, zone.height, 0xffff00, 0.3);\n            indicator.setStroke(2, 0xffff00);\n            indicator.setDepth(1000); // Always visible on top\n            \n            this.transitionZones.add(transitionZone);\n        });\n    }\n\n    checkAreaTransitions() {\n        // Check if player is in any transition zone\n        const playerPos = this.player.getPosition();\n        const playerGridX = Math.floor(playerPos.x / this.tileSize);\n        const playerGridY = Math.floor(playerPos.y / this.tileSize);\n        \n        this.transitionZones.children.entries.forEach(zone => {\n            const zoneGridX = Math.floor(zone.x / this.tileSize);\n            const zoneGridY = Math.floor(zone.y / this.tileSize);\n            \n            if (playerGridX === zoneGridX && playerGridY === zoneGridY) {\n                this.triggerAreaTransition(zone.getData('direction'), zone.getData('targetArea'));\n            }\n        });\n    }\n\n    triggerAreaTransition(direction, targetArea) {\n        // For now, just show a message about the transition\n        // In future tasks, this will load new areas and handle story progression\n        console.log(`Area transition triggered: ${direction} to ${targetArea}`);\n        \n        // Add visual feedback for the transition\n        const transitionText = this.add.text(\n            this.cameras.main.centerX, \n            this.cameras.main.centerY - 50, \n            `Entering ${targetArea.replace('_', ' ')}...`, \n            {\n                fontSize: '24px',\n                fontFamily: 'Arial',\n                color: '#ffffff',\n                backgroundColor: 'rgba(0,0,0,0.8)',\n                padding: { x: 20, y: 10 }\n            }\n        );\n        transitionText.setOrigin(0.5);\n        transitionText.setScrollFactor(0);\n        transitionText.setDepth(2000);\n        \n        // Fade out the transition text after 2 seconds\n        this.tweens.add({\n            targets: transitionText,\n            alpha: 0,\n            duration: 2000,\n            delay: 1000,\n            onComplete: () => {\n                transitionText.destroy();\n            }\n        });\n    }\n\n    initializeStorySystem() {\n        // Get the story system from GameManager\n        const gameManager = this.plugins.get('GameManager');\n        if (gameManager && gameManager.getStorySystem()) {\n            this.storySystem = gameManager.getStorySystem();\n            \n            // Set up story event listeners\n            this.setupStoryEventListeners();\n            \n            // Add story progress indicator to UI\n            this.addStoryProgressUI();\n            \n            // Add test controls for story system (development only)\n            this.addStoryTestControls();\n            \n            console.log('Story system integrated with GameWorldScene');\n        } else {\n            console.warn('Story system not available');\n        }\n\n        // Initialize power system integration\n        this.initializePowerSystem();\n    }\n\n    /**\n     * Initialize power system integration\n     */\n    initializePowerSystem() {\n        const gameManager = this.plugins.get('GameManager');\n        if (gameManager && gameManager.getPowerSystem()) {\n            this.powerSystem = gameManager.getPowerSystem();\n            \n            // Set up power event listeners\n            this.setupPowerEventListeners();\n            \n            // Add power UI elements\n            this.addPowerUI();\n            \n            console.log('Power system integrated with GameWorldScene');\n        } else {\n            console.warn('Power system not available');\n        }\n    }\n\n    /**\n     * Set up power system event listeners\n     */\n    setupPowerEventListeners() {\n        if (!this.powerSystem) return;\n\n        // Listen for power unlocks\n        this.powerSystem.addEventListener('power_unlocked', (data) => {\n            this.showPowerUnlockNotification(data.power, data.storyTrigger);\n            this.updatePowerUI();\n        });\n\n        // Listen for power activations\n        this.powerSystem.addEventListener('power_activated', (data) => {\n            this.showPowerActivationFeedback(data.power, data.context);\n        });\n\n        // Listen for power deactivations\n        this.powerSystem.addEventListener('power_deactivated', (data) => {\n            console.log(`Power deactivated: ${data.power.name}`);\n        });\n    }\n\n    setupStoryEventListeners() {\n        if (!this.storySystem) return;\n\n        // Listen for story events that should trigger dialogue\n        this.storySystem.addEventListener('story_event_triggered', (eventData) => {\n            if (eventData && eventData.type === 'dialogue') {\n                this.triggerDialogue(eventData);\n            }\n        });\n\n        // Listen for power unlocks\n        this.storySystem.addEventListener('power_unlocked', (data) => {\n            this.showPowerUnlockNotification(data.powerId);\n        });\n\n        // Listen for checkpoint changes\n        this.storySystem.addEventListener('checkpoint_reached', (data) => {\n            this.showCheckpointNotification(data.checkpointId);\n        });\n\n        // Listen for flag changes\n        this.storySystem.addEventListener('flag_changed', (data) => {\n            console.log(`Story flag changed: ${data.flag} = ${data.value}`);\n        });\n    }\n\n    /**\n     * Set up scene event handlers\n     */\n    setupSceneEvents() {\n        // Handle scene resume when dialogue closes\n        this.events.on('resume', () => {\n            console.log('GameWorldScene resumed from dialogue');\n            // Update story progress UI when returning from dialogue\n            this.updateStoryProgressUI();\n        });\n    }\n\n    /**\n     * Trigger dialogue scene with story event data\n     * @param {Object} dialogueEvent - Story event with dialogue content\n     */\n    triggerDialogue(dialogueEvent) {\n        console.log('Triggering dialogue:', dialogueEvent.id);\n        \n        // Launch dialogue scene with the event data\n        this.scene.launch('DialogueScene', {\n            dialogueEvent: dialogueEvent,\n            previousScene: 'GameWorldScene'\n        });\n        \n        // Pause this scene while dialogue is active\n        this.scene.pause();\n    }\n\n    addStoryProgressUI() {\n        if (!this.storySystem) return;\n\n        // Add story progress indicator\n        const progress = this.storySystem.getStoryProgress();\n        this.storyProgressText = this.add.text(10, 120, '', {\n            fontSize: '12px',\n            fontFamily: 'Arial',\n            color: '#ecf0f1',\n            backgroundColor: 'rgba(0,0,0,0.5)',\n            padding: { x: 6, y: 3 }\n        });\n        this.storyProgressText.setScrollFactor(0);\n        this.updateStoryProgressUI();\n        \n        this.uiContainer.add(this.storyProgressText);\n    }\n\n    updateStoryProgressUI() {\n        if (!this.storySystem || !this.storyProgressText) return;\n\n        const progress = this.storySystem.getStoryProgress();\n        const checkpoint = this.storySystem.getCurrentCheckpoint();\n        \n        this.storyProgressText.setText([\n            `Checkpoint: ${checkpoint ? checkpoint.name : 'Unknown'}`,\n            `Events: ${progress.completedEvents}/${progress.totalEvents}`,\n            `Powers: ${progress.unlockedPowers}`\n        ]);\n    }\n\n    addStoryTestControls() {\n        if (!this.storySystem) return;\n\n        // Add test keys for story system (development only)\n        this.testKeys = {\n            T: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.T), // Trigger next story event\n            D: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D), // Trigger dialogue\n            P: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P), // Unlock power\n            F: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F), // Toggle flag\n            R: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.R)  // Reset story\n        };\n\n        // Add test instructions to UI\n        const testInstructions = this.add.text(10, 180, \n            'Story Test Controls:\\nT - Trigger story event\\nD - Test dialogue\\nP - Unlock power\\nF - Toggle flag\\nR - Reset story', {\n            fontSize: '10px',\n            fontFamily: 'Arial',\n            color: '#f39c12',\n            backgroundColor: 'rgba(0,0,0,0.5)',\n            padding: { x: 6, y: 3 }\n        });\n        testInstructions.setScrollFactor(0);\n        this.uiContainer.add(testInstructions);\n    }\n\n    showPowerUnlockNotification(powerId) {\n        const notification = this.add.text(\n            this.cameras.main.centerX,\n            this.cameras.main.centerY,\n            `Power Unlocked: ${powerId.toUpperCase()}!`,\n            {\n                fontSize: '28px',\n                fontFamily: 'Arial',\n                color: '#f1c40f',\n                backgroundColor: 'rgba(0,0,0,0.8)',\n                padding: { x: 20, y: 10 }\n            }\n        );\n        notification.setOrigin(0.5);\n        notification.setScrollFactor(0);\n        notification.setDepth(3000);\n\n        // Animate the notification\n        this.tweens.add({\n            targets: notification,\n            scaleX: 1.2,\n            scaleY: 1.2,\n            duration: 300,\n            yoyo: true,\n            onComplete: () => {\n                this.tweens.add({\n                    targets: notification,\n                    alpha: 0,\n                    duration: 1500,\n                    delay: 1000,\n                    onComplete: () => notification.destroy()\n                });\n            }\n        });\n    }\n\n    showCheckpointNotification(checkpointId) {\n        const checkpoint = this.storySystem.getCurrentCheckpoint();\n        const notification = this.add.text(\n            this.cameras.main.centerX,\n            this.cameras.main.centerY + 50,\n            `Checkpoint: ${checkpoint ? checkpoint.name : checkpointId}`,\n            {\n                fontSize: '18px',\n                fontFamily: 'Arial',\n                color: '#2ecc71',\n                backgroundColor: 'rgba(0,0,0,0.8)',\n                padding: { x: 15, y: 8 }\n            }\n        );\n        notification.setOrigin(0.5);\n        notification.setScrollFactor(0);\n        notification.setDepth(3000);\n\n        this.tweens.add({\n            targets: notification,\n            alpha: 0,\n            duration: 2000,\n            delay: 1500,\n            onComplete: () => notification.destroy()\n        });\n\n        // Update story progress UI\n        this.updateStoryProgressUI();\n    }\n\n    handleStoryTestControls() {\n        if (!this.storySystem || !this.testKeys) return;\n\n        // Trigger story events\n        if (Phaser.Input.Keyboard.JustDown(this.testKeys.T)) {\n            // Cycle through story events for testing\n            const events = ['first_dialogue', 'tutorial_start', 'first_power_unlock', 'story_branch_choice'];\n            const randomEvent = events[Math.floor(Math.random() * events.length)];\n            this.storySystem.triggerStoryEvent(randomEvent);\n        }\n\n        // Test dialogue directly\n        if (Phaser.Input.Keyboard.JustDown(this.testKeys.D)) {\n            // Trigger a dialogue event directly\n            const dialogueEvents = ['game_start', 'first_dialogue', 'story_branch_choice'];\n            const randomDialogue = dialogueEvents[Math.floor(Math.random() * dialogueEvents.length)];\n            const event = this.storySystem.triggerStoryEvent(randomDialogue);\n            if (event && event.type === 'dialogue') {\n                this.triggerDialogue(event);\n            }\n        }\n\n        // Test power unlock\n        if (Phaser.Input.Keyboard.JustDown(this.testKeys.P)) {\n            this.storySystem.unlockPower('telekinesis');\n        }\n\n        // Test flag toggle\n        if (Phaser.Input.Keyboard.JustDown(this.testKeys.F)) {\n            const currentFlag = this.storySystem.getStoryFlag('tutorial_completed');\n            this.storySystem.setStoryFlag('tutorial_completed', !currentFlag);\n        }\n\n        // Reset story\n        if (Phaser.Input.Keyboard.JustDown(this.testKeys.R)) {\n            this.storySystem.resetStory();\n            this.updateStoryProgressUI();\n        }\n    }\n\n    /**\n     * Add power UI elements to the scene\n     */\n    addPowerUI() {\n        if (!this.powerSystem) return;\n\n        // Add power list indicator\n        this.powerListText = this.add.text(10, 280, '', {\n            fontSize: '11px',\n            fontFamily: 'Arial',\n            color: '#e67e22',\n            backgroundColor: 'rgba(0,0,0,0.5)',\n            padding: { x: 6, y: 3 }\n        });\n        this.powerListText.setScrollFactor(0);\n        this.updatePowerUI();\n        \n        this.uiContainer.add(this.powerListText);\n\n        // Add power controls instructions\n        const powerInstructions = this.add.text(10, 350, \n            'Power Controls:\\nQ - Telekinesis\\nE - Enhanced Vision\\nR - Time Slow\\nF - Phase Walk', {\n            fontSize: '10px',\n            fontFamily: 'Arial',\n            color: '#9b59b6',\n            backgroundColor: 'rgba(0,0,0,0.5)',\n            padding: { x: 6, y: 3 }\n        });\n        powerInstructions.setScrollFactor(0);\n        this.uiContainer.add(powerInstructions);\n    }\n\n    /**\n     * Update power UI display\n     */\n    updatePowerUI() {\n        if (!this.powerSystem || !this.powerListText) return;\n\n        const unlockedPowers = this.powerSystem.getUnlockedPowerList();\n        \n        if (unlockedPowers.length === 0) {\n            this.powerListText.setText('No powers unlocked');\n        } else {\n            const powerTexts = unlockedPowers.map(power => {\n                const cooldown = this.powerSystem.getRemainingCooldown(power.id);\n                const isActive = this.powerSystem.isPowerActive(power.id);\n                let status = '';\n                \n                if (isActive) {\n                    status = ' [ACTIVE]';\n                } else if (cooldown > 0) {\n                    status = ` [${Math.ceil(cooldown / 1000)}s]`;\n                } else {\n                    status = ' [READY]';\n                }\n                \n                return `${power.name}${status}`;\n            });\n            \n            this.powerListText.setText([\n                'Unlocked Powers:',\n                ...powerTexts\n            ]);\n        }\n    }\n\n    /**\n     * Show power activation feedback (overrides the one from PowerSystem for scene-specific behavior)\n     * @param {Object} power - Power that was activated\n     * @param {Object} context - Activation context\n     */\n    showPowerActivationFeedback(power, context) {\n        if (!power) return;\n\n        // Show power name briefly\n        const feedback = this.add.text(\n            this.cameras.main.centerX,\n            this.cameras.main.centerY + 150,\n            `${power.name} Activated!`,\n            {\n                fontSize: '18px',\n                fontFamily: 'Arial',\n                color: '#9b59b6',\n                backgroundColor: 'rgba(0,0,0,0.7)',\n                padding: { x: 10, y: 5 }\n            }\n        );\n        feedback.setOrigin(0.5);\n        feedback.setScrollFactor(0);\n        feedback.setDepth(4000);\n\n        this.tweens.add({\n            targets: feedback,\n            alpha: 0,\n            y: feedback.y - 30,\n            duration: 1500,\n            onComplete: () => feedback.destroy()\n        });\n\n        // Update power UI to show cooldowns\n        this.updatePowerUI();\n    }\n\n    isCollisionTile(gridX, gridY) {\n        // Check if coordinates are within world bounds\n        if (gridX < 0 || gridX >= this.worldWidth || gridY < 0 || gridY >= this.worldHeight) {\n            return true; // Out of bounds is considered collision\n        }\n\n        // Check if the tile type is collidable\n        const tileType = this.worldData[gridY][gridX];\n        \n        // Check if player is phasing through obstacles\n        if (this.player && this.player.isPhasing) {\n            // Allow phasing through trees and water, but not stone walls\n            return tileType === 'stone';\n        }\n        \n        return tileType === 'stone' || tileType === 'water' || tileType === 'tree';\n    }\n}","/**\n * DialogueScene - Handles story conversations and dialogue trees\n * Provides UI for displaying dialogue text, speaker names, and choice options\n */\nexport default class DialogueScene extends Phaser.Scene {\n    constructor() {\n        super({ key: 'DialogueScene' });\n        \n        // Dialogue state\n        this.currentDialogue = null;\n        this.currentText = '';\n        this.displayedText = '';\n        this.textIndex = 0;\n        this.isTyping = false;\n        this.typingSpeed = 30; // Characters per second\n        this.lastTypeTime = 0;\n        \n        // UI elements\n        this.dialogueBox = null;\n        this.speakerText = null;\n        this.dialogueText = null;\n        this.continueIndicator = null;\n        this.choiceButtons = [];\n        \n        // Input handling\n        this.spaceKey = null;\n        this.enterKey = null;\n        this.escKey = null;\n        \n        // Scene management\n        this.previousScene = null;\n        this.storySystem = null;\n    }\n\n    preload() {\n        // Create dialogue UI graphics\n        this.createDialogueUIGraphics();\n    }\n\n    create(data) {\n        // Get story system reference\n        this.initializeStorySystem();\n        \n        // Create dialogue UI\n        this.createDialogueUI();\n        \n        // Set up input controls\n        this.setupControls();\n        \n        // Set up scene events\n        this.setupSceneEvents();\n        \n        // Handle launch data\n        if (data && data.dialogueEvent) {\n            this.startDialogue(data.dialogueEvent, data.previousScene);\n        }\n        \n        console.log('DialogueScene created');\n    }\n\n    createDialogueUIGraphics() {\n        // Create dialogue box background\n        const boxGraphics = this.add.graphics();\n        boxGraphics.fillStyle(0x2c3e50, 0.9);\n        boxGraphics.fillRoundedRect(0, 0, 760, 150, 10);\n        boxGraphics.lineStyle(3, 0x34495e, 1);\n        boxGraphics.strokeRoundedRect(0, 0, 760, 150, 10);\n        boxGraphics.generateTexture('dialogue-box', 760, 150);\n        boxGraphics.destroy();\n\n        // Create speaker name background\n        const speakerGraphics = this.add.graphics();\n        speakerGraphics.fillStyle(0x34495e, 0.95);\n        speakerGraphics.fillRoundedRect(0, 0, 200, 40, 8);\n        speakerGraphics.lineStyle(2, 0x5d6d7e, 1);\n        speakerGraphics.strokeRoundedRect(0, 0, 200, 40, 8);\n        speakerGraphics.generateTexture('speaker-box', 200, 40);\n        speakerGraphics.destroy();\n\n        // Create choice button background\n        const choiceGraphics = this.add.graphics();\n        choiceGraphics.fillStyle(0x3498db, 0.8);\n        choiceGraphics.fillRoundedRect(0, 0, 350, 45, 8);\n        choiceGraphics.lineStyle(2, 0x2980b9, 1);\n        choiceGraphics.strokeRoundedRect(0, 0, 350, 45, 8);\n        choiceGraphics.generateTexture('choice-button', 350, 45);\n        choiceGraphics.destroy();\n\n        // Create choice button hover state\n        const choiceHoverGraphics = this.add.graphics();\n        choiceHoverGraphics.fillStyle(0x5dade2, 0.9);\n        choiceHoverGraphics.fillRoundedRect(0, 0, 350, 45, 8);\n        choiceHoverGraphics.lineStyle(2, 0x3498db, 1);\n        choiceHoverGraphics.strokeRoundedRect(0, 0, 350, 45, 8);\n        choiceHoverGraphics.generateTexture('choice-button-hover', 350, 45);\n        choiceHoverGraphics.destroy();\n\n        // Create continue indicator (small arrow)\n        const arrowGraphics = this.add.graphics();\n        arrowGraphics.fillStyle(0xf39c12, 1);\n        arrowGraphics.fillTriangle(0, 0, 15, 7, 0, 14);\n        arrowGraphics.generateTexture('continue-arrow', 15, 14);\n        arrowGraphics.destroy();\n    }\n\n    createDialogueUI() {\n        // Create main dialogue container\n        this.dialogueContainer = this.add.container(0, 0);\n        \n        // Position dialogue box at bottom of screen\n        const boxY = this.cameras.main.height - 170;\n        \n        // Create dialogue box background\n        this.dialogueBox = this.add.image(20, boxY, 'dialogue-box');\n        this.dialogueBox.setOrigin(0, 0);\n        this.dialogueBox.setVisible(false);\n        \n        // Create speaker name box\n        this.speakerBox = this.add.image(30, boxY - 25, 'speaker-box');\n        this.speakerBox.setOrigin(0, 0);\n        this.speakerBox.setVisible(false);\n        \n        // Create speaker name text\n        this.speakerText = this.add.text(130, boxY - 5, '', {\n            fontSize: '18px',\n            fontFamily: 'Arial',\n            color: '#ecf0f1',\n            fontStyle: 'bold'\n        });\n        this.speakerText.setOrigin(0.5, 0.5);\n        this.speakerText.setVisible(false);\n        \n        // Create dialogue text\n        this.dialogueText = this.add.text(50, boxY + 30, '', {\n            fontSize: '16px',\n            fontFamily: 'Arial',\n            color: '#ecf0f1',\n            wordWrap: { width: 700, useAdvancedWrap: true },\n            lineSpacing: 5\n        });\n        this.dialogueText.setOrigin(0, 0);\n        this.dialogueText.setVisible(false);\n        \n        // Create continue indicator\n        this.continueIndicator = this.add.image(750, boxY + 120, 'continue-arrow');\n        this.continueIndicator.setOrigin(0.5, 0.5);\n        this.continueIndicator.setVisible(false);\n        \n        // Add pulsing animation to continue indicator\n        this.tweens.add({\n            targets: this.continueIndicator,\n            alpha: 0.3,\n            duration: 800,\n            yoyo: true,\n            repeat: -1,\n            ease: 'Sine.easeInOut'\n        });\n        \n        // Add all elements to container\n        this.dialogueContainer.add([\n            this.dialogueBox,\n            this.speakerBox,\n            this.speakerText,\n            this.dialogueText,\n            this.continueIndicator\n        ]);\n        \n        // Create choices container (separate from main dialogue)\n        this.choicesContainer = this.add.container(0, 0);\n        this.choicesContainer.setVisible(false);\n    }\n\n    setupControls() {\n        // Create input keys\n        this.spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.enterKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);\n        this.escKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ESC);\n        \n        // Add click input for dialogue advancement\n        this.input.on('pointerdown', this.handleDialogueAdvance, this);\n    }\n\n    setupSceneEvents() {\n        // Listen for scene data when started\n        this.events.on('wake', this.handleSceneWake, this);\n        this.events.on('sleep', this.handleSceneSleep, this);\n    }\n\n    initializeStorySystem() {\n        // Get story system from GameManager\n        const gameManager = this.plugins.get('GameManager');\n        if (gameManager && gameManager.getStorySystem()) {\n            this.storySystem = gameManager.getStorySystem();\n            console.log('DialogueScene connected to StorySystem');\n        } else {\n            console.warn('StorySystem not available in DialogueScene');\n        }\n    }\n\n    /**\n     * Start dialogue with given event data\n     * @param {Object} dialogueData - Dialogue event data\n     * @param {string} previousScene - Scene to return to after dialogue\n     */\n    startDialogue(dialogueData, previousScene = 'GameWorldScene') {\n        this.currentDialogue = dialogueData;\n        this.previousScene = previousScene;\n        \n        // Show dialogue UI\n        this.showDialogueUI();\n        \n        // Start typing the dialogue text\n        this.startTypingText(dialogueData.content.text, dialogueData.content.speaker);\n        \n        console.log('Started dialogue:', dialogueData.id);\n    }\n\n    showDialogueUI() {\n        // Show all dialogue UI elements\n        this.dialogueBox.setVisible(true);\n        this.speakerBox.setVisible(true);\n        this.speakerText.setVisible(true);\n        this.dialogueText.setVisible(true);\n        \n        // Hide continue indicator initially\n        this.continueIndicator.setVisible(false);\n        \n        // Hide choices initially\n        this.hideChoices();\n    }\n\n    hideDialogueUI() {\n        // Hide all dialogue UI elements\n        this.dialogueBox.setVisible(false);\n        this.speakerBox.setVisible(false);\n        this.speakerText.setVisible(false);\n        this.dialogueText.setVisible(false);\n        this.continueIndicator.setVisible(false);\n        \n        // Hide choices\n        this.hideChoices();\n    }\n\n    startTypingText(text, speaker) {\n        // Set up typing state\n        this.currentText = text;\n        this.displayedText = '';\n        this.textIndex = 0;\n        this.isTyping = true;\n        this.lastTypeTime = 0;\n        \n        // Set speaker name\n        this.speakerText.setText(speaker || 'Unknown');\n        \n        // Clear dialogue text\n        this.dialogueText.setText('');\n        \n        // Hide continue indicator while typing\n        this.continueIndicator.setVisible(false);\n    }\n\n    update(time, delta) {\n        // Handle text typing animation\n        if (this.isTyping) {\n            this.updateTextTyping(time);\n        }\n        \n        // Handle input\n        this.handleInput();\n    }\n\n    updateTextTyping(time) {\n        // Check if enough time has passed for next character\n        if (time - this.lastTypeTime > (1000 / this.typingSpeed)) {\n            if (this.textIndex < this.currentText.length) {\n                // Add next character\n                this.displayedText += this.currentText[this.textIndex];\n                this.textIndex++;\n                this.lastTypeTime = time;\n                \n                // Update displayed text\n                this.dialogueText.setText(this.displayedText);\n            } else {\n                // Typing complete\n                this.isTyping = false;\n                this.onTypingComplete();\n            }\n        }\n    }\n\n    onTypingComplete() {\n        // Show continue indicator or choices\n        if (this.currentDialogue && this.currentDialogue.content.choices) {\n            this.showChoices(this.currentDialogue.content.choices);\n        } else {\n            this.continueIndicator.setVisible(true);\n        }\n    }\n\n    handleInput() {\n        // Handle dialogue advancement\n        if (Phaser.Input.Keyboard.JustDown(this.spaceKey) || \n            Phaser.Input.Keyboard.JustDown(this.enterKey)) {\n            this.handleDialogueAdvance();\n        }\n        \n        // Handle escape to close dialogue\n        if (Phaser.Input.Keyboard.JustDown(this.escKey)) {\n            this.closeDialogue();\n        }\n    }\n\n    handleDialogueAdvance() {\n        if (this.isTyping) {\n            // Skip typing animation\n            this.skipTyping();\n        } else if (this.currentDialogue) {\n            // Advance to next dialogue or close\n            this.advanceDialogue();\n        }\n    }\n\n    skipTyping() {\n        // Complete typing immediately\n        this.isTyping = false;\n        this.displayedText = this.currentText;\n        this.textIndex = this.currentText.length;\n        this.dialogueText.setText(this.displayedText);\n        this.onTypingComplete();\n    }\n\n    advanceDialogue() {\n        // Check if there are choices to show\n        if (this.currentDialogue.content.choices && this.choicesContainer.visible) {\n            // Choices are already shown, wait for selection\n            return;\n        }\n        \n        // Check if there's a next event\n        if (this.currentDialogue.content.nextEvent) {\n            // Trigger next story event\n            if (this.storySystem) {\n                const nextEvent = this.storySystem.triggerStoryEvent(this.currentDialogue.content.nextEvent);\n                if (nextEvent) {\n                    this.startDialogue(nextEvent, this.previousScene);\n                    return;\n                }\n            }\n        }\n        \n        // No next event, close dialogue\n        this.closeDialogue();\n    }\n\n    showChoices(choices) {\n        // Clear existing choices\n        this.hideChoices();\n        \n        // Create choice buttons\n        const startY = this.cameras.main.height - 300;\n        const spacing = 60;\n        \n        choices.forEach((choice, index) => {\n            const y = startY + (index * spacing);\n            \n            // Create choice button\n            const button = this.add.image(400, y, 'choice-button');\n            button.setOrigin(0.5, 0.5);\n            button.setInteractive();\n            \n            // Create choice text\n            const text = this.add.text(400, y, choice.text, {\n                fontSize: '14px',\n                fontFamily: 'Arial',\n                color: '#ecf0f1',\n                wordWrap: { width: 320, useAdvancedWrap: true },\n                align: 'center'\n            });\n            text.setOrigin(0.5, 0.5);\n            \n            // Add hover effects\n            button.on('pointerover', () => {\n                button.setTexture('choice-button-hover');\n                text.setColor('#ffffff');\n            });\n            \n            button.on('pointerout', () => {\n                button.setTexture('choice-button');\n                text.setColor('#ecf0f1');\n            });\n            \n            // Add click handler\n            button.on('pointerdown', () => {\n                this.selectChoice(choice, index);\n            });\n            \n            // Store references\n            this.choiceButtons.push({ button, text });\n            this.choicesContainer.add([button, text]);\n        });\n        \n        // Show choices container\n        this.choicesContainer.setVisible(true);\n    }\n\n    hideChoices() {\n        // Clear choice buttons\n        this.choiceButtons.forEach(({ button, text }) => {\n            button.destroy();\n            text.destroy();\n        });\n        this.choiceButtons = [];\n        \n        // Clear choices container\n        this.choicesContainer.removeAll();\n        this.choicesContainer.setVisible(false);\n    }\n\n    selectChoice(choice, index) {\n        console.log(`Choice selected: ${index} - ${choice.text}`);\n        \n        // Process choice effects\n        if (choice.effects && this.storySystem) {\n            choice.effects.forEach(effect => {\n                switch (effect.type) {\n                    case 'set_flag':\n                        this.storySystem.setStoryFlag(effect.flag, effect.value);\n                        break;\n                    case 'unlock_power':\n                        this.storySystem.unlockPower(effect.powerId);\n                        break;\n                    case 'set_checkpoint':\n                        this.storySystem.setCheckpoint(effect.checkpointId);\n                        break;\n                }\n            });\n        }\n        \n        // Hide choices\n        this.hideChoices();\n        \n        // Trigger next event if specified\n        if (choice.nextEvent && this.storySystem) {\n            const nextEvent = this.storySystem.triggerStoryEvent(choice.nextEvent);\n            if (nextEvent) {\n                this.startDialogue(nextEvent, this.previousScene);\n                return;\n            }\n        }\n        \n        // No next event, close dialogue\n        this.closeDialogue();\n    }\n\n    closeDialogue() {\n        // Hide dialogue UI\n        this.hideDialogueUI();\n        \n        // Reset dialogue state\n        this.currentDialogue = null;\n        this.currentText = '';\n        this.displayedText = '';\n        this.textIndex = 0;\n        this.isTyping = false;\n        \n        // Return to previous scene\n        if (this.previousScene) {\n            this.scene.resume(this.previousScene);\n            this.scene.stop();\n        }\n        \n        console.log('Dialogue closed, returning to:', this.previousScene);\n    }\n\n    handleSceneWake(sys, data) {\n        // Handle scene wake with dialogue data\n        if (data && data.dialogueEvent) {\n            this.startDialogue(data.dialogueEvent, data.previousScene);\n        }\n    }\n\n    handleSceneSleep() {\n        // Clean up when scene sleeps\n        this.hideDialogueUI();\n    }\n\n    /**\n     * Public method to trigger dialogue from other scenes\n     * @param {Object} dialogueEvent - Story event with dialogue content\n     * @param {string} previousScene - Scene to return to\n     */\n    static showDialogue(scene, dialogueEvent, previousScene = 'GameWorldScene') {\n        // Launch dialogue scene with data\n        scene.scene.launch('DialogueScene', {\n            dialogueEvent: dialogueEvent,\n            previousScene: previousScene\n        });\n        \n        // Pause the current scene\n        scene.scene.pause();\n    }\n}","// Placeholder for InventoryScene\nexport default class InventoryScene extends Phaser.Scene {\n    constructor() {\n        super({ key: 'InventoryScene' });\n    }\n}","/**\n * StorySystem - Manages narrative progression, story events, and branching storylines\n * Handles story data loading, event triggering, progress tracking, and flag management\n */\nexport default class StorySystem {\n    constructor(scene) {\n        this.scene = scene;\n        this.storyData = null;\n        this.currentCheckpoint = 'game_start';\n        this.completedEvents = new Set();\n        this.storyFlags = new Map();\n        this.unlockedPowers = new Set();\n        this.eventListeners = new Map();\n        \n        // Initialize with default story state\n        this.initializeStoryState();\n    }\n\n    /**\n     * Initialize default story state\n     */\n    initializeStoryState() {\n        this.storyFlags.set('game_started', false);\n        this.storyFlags.set('first_dialogue_seen', false);\n        this.storyFlags.set('tutorial_completed', false);\n    }\n\n    /**\n     * Load story data from JSON file\n     * @param {string} storyFile - Path to the story JSON file\n     * @returns {Promise<boolean>} - Success status\n     */\n    async loadStoryData(storyFile) {\n        try {\n            const response = await fetch(storyFile);\n            if (!response.ok) {\n                throw new Error(`Failed to load story data: ${response.status}`);\n            }\n            \n            this.storyData = await response.json();\n            \n            // Validate story data structure\n            if (!this.validateStoryData(this.storyData)) {\n                throw new Error('Invalid story data structure');\n            }\n            \n            console.log('Story data loaded successfully');\n            return true;\n        } catch (error) {\n            console.error('Error loading story data:', error);\n            // Load fallback story data\n            this.loadFallbackStoryData();\n            return false;\n        }\n    }\n\n    /**\n     * Validate story data structure\n     * @param {Object} data - Story data to validate\n     * @returns {boolean} - Validation result\n     */\n    validateStoryData(data) {\n        return data && \n               data.events && \n               Array.isArray(data.events) &&\n               data.checkpoints &&\n               typeof data.checkpoints === 'object';\n    }\n\n    /**\n     * Load fallback story data when main data fails\n     */\n    loadFallbackStoryData() {\n        this.storyData = {\n            events: [\n                {\n                    id: 'game_start',\n                    type: 'dialogue',\n                    triggers: [],\n                    content: {\n                        text: 'Welcome to your adventure!',\n                        speaker: 'Narrator',\n                        nextEvent: null\n                    }\n                }\n            ],\n            checkpoints: {\n                'game_start': {\n                    id: 'game_start',\n                    name: 'Beginning',\n                    description: 'The start of your journey'\n                }\n            }\n        };\n        console.log('Fallback story data loaded');\n    }\n\n    /**\n     * Trigger a story event by ID\n     * @param {string} eventId - ID of the event to trigger\n     * @returns {Object|null} - Event data or null if not found/conditions not met\n     */\n    triggerStoryEvent(eventId) {\n        if (!this.storyData || !this.storyData.events) {\n            console.warn('No story data available');\n            return null;\n        }\n\n        const event = this.storyData.events.find(e => e.id === eventId);\n        if (!event) {\n            console.warn(`Story event not found: ${eventId}`);\n            return null;\n        }\n\n        // Check if event conditions are met\n        if (!this.checkStoryConditions(event.triggers || [])) {\n            console.log(`Story event conditions not met: ${eventId}`);\n            return null;\n        }\n\n        // Mark event as completed\n        this.completedEvents.add(eventId);\n        \n        // Process event effects\n        this.processEventEffects(event);\n        \n        // Emit event for listeners\n        this.emitStoryEvent(eventId, event);\n        this.emitStoryEvent('story_event_triggered', event);\n        \n        console.log(`Story event triggered: ${eventId}`);\n        return event;\n    }\n\n    /**\n     * Check if story conditions are met\n     * @param {Array} conditions - Array of condition objects\n     * @returns {boolean} - Whether all conditions are met\n     */\n    checkStoryConditions(conditions) {\n        if (!conditions || conditions.length === 0) {\n            return true;\n        }\n\n        return conditions.every(condition => {\n            switch (condition.type) {\n                case 'flag':\n                    return this.storyFlags.get(condition.flag) === condition.value;\n                case 'event_completed':\n                    return this.completedEvents.has(condition.eventId);\n                case 'power_unlocked':\n                    return this.unlockedPowers.has(condition.powerId);\n                case 'checkpoint_reached':\n                    return this.hasReachedCheckpoint(condition.checkpointId);\n                default:\n                    console.warn(`Unknown condition type: ${condition.type}`);\n                    return false;\n            }\n        });\n    }\n\n    /**\n     * Process event effects (power unlocks, flag changes, etc.)\n     * @param {Object} event - Event object\n     */\n    processEventEffects(event) {\n        if (!event.effects) return;\n\n        event.effects.forEach(effect => {\n            switch (effect.type) {\n                case 'unlock_power':\n                    this.unlockPower(effect.powerId);\n                    break;\n                case 'set_flag':\n                    this.setStoryFlag(effect.flag, effect.value);\n                    break;\n                case 'set_checkpoint':\n                    this.setCheckpoint(effect.checkpointId);\n                    break;\n                default:\n                    console.warn(`Unknown effect type: ${effect.type}`);\n            }\n        });\n    }\n\n    /**\n     * Set story progress to a specific checkpoint\n     * @param {string} checkpointId - ID of the checkpoint\n     */\n    setCheckpoint(checkpointId) {\n        if (!this.storyData || !this.storyData.checkpoints || !this.storyData.checkpoints[checkpointId]) {\n            console.warn(`Invalid checkpoint: ${checkpointId}`);\n            return;\n        }\n\n        this.currentCheckpoint = checkpointId;\n        console.log(`Checkpoint set: ${checkpointId}`);\n        \n        // Emit checkpoint event\n        this.emitStoryEvent('checkpoint_reached', { checkpointId });\n    }\n\n    /**\n     * Check if a checkpoint has been reached\n     * @param {string} checkpointId - ID of the checkpoint to check\n     * @returns {boolean} - Whether checkpoint has been reached\n     */\n    hasReachedCheckpoint(checkpointId) {\n        if (!this.storyData || !this.storyData.checkpoints) {\n            return false;\n        }\n\n        // Simple implementation: check if current checkpoint is the same or later\n        // In a more complex system, you'd have checkpoint ordering\n        return this.currentCheckpoint === checkpointId || this.completedEvents.has(`checkpoint_${checkpointId}`);\n    }\n\n    /**\n     * Get current checkpoint information\n     * @returns {Object|null} - Current checkpoint data\n     */\n    getCurrentCheckpoint() {\n        if (!this.storyData || !this.storyData.checkpoints) {\n            return null;\n        }\n        return this.storyData.checkpoints[this.currentCheckpoint] || null;\n    }\n\n    /**\n     * Set a story flag value\n     * @param {string} flag - Flag name\n     * @param {*} value - Flag value\n     */\n    setStoryFlag(flag, value) {\n        const oldValue = this.storyFlags.get(flag);\n        this.storyFlags.set(flag, value);\n        \n        console.log(`Story flag set: ${flag} = ${value} (was: ${oldValue})`);\n        \n        // Emit flag change event\n        this.emitStoryEvent('flag_changed', { flag, value, oldValue });\n    }\n\n    /**\n     * Get a story flag value\n     * @param {string} flag - Flag name\n     * @returns {*} - Flag value\n     */\n    getStoryFlag(flag) {\n        return this.storyFlags.get(flag);\n    }\n\n    /**\n     * Check if a story flag has a specific value\n     * @param {string} flag - Flag name\n     * @param {*} value - Expected value\n     * @returns {boolean} - Whether flag matches value\n     */\n    checkStoryFlag(flag, value) {\n        return this.storyFlags.get(flag) === value;\n    }\n\n    /**\n     * Unlock a power through story progression\n     * @param {string} powerId - ID of the power to unlock\n     */\n    unlockPower(powerId) {\n        if (this.unlockedPowers.has(powerId)) {\n            console.log(`Power already unlocked: ${powerId}`);\n            return;\n        }\n\n        this.unlockedPowers.add(powerId);\n        console.log(`Power unlocked: ${powerId}`);\n        \n        // Emit power unlock event\n        this.emitStoryEvent('power_unlocked', { powerId });\n    }\n\n    /**\n     * Check if a power is unlocked\n     * @param {string} powerId - ID of the power to check\n     * @returns {boolean} - Whether power is unlocked\n     */\n    isPowerUnlocked(powerId) {\n        return this.unlockedPowers.has(powerId);\n    }\n\n    /**\n     * Get all unlocked powers\n     * @returns {Array<string>} - Array of unlocked power IDs\n     */\n    getUnlockedPowers() {\n        return Array.from(this.unlockedPowers);\n    }\n\n    /**\n     * Add event listener for story events\n     * @param {string} eventType - Type of event to listen for\n     * @param {Function} callback - Callback function\n     */\n    addEventListener(eventType, callback) {\n        if (!this.eventListeners.has(eventType)) {\n            this.eventListeners.set(eventType, []);\n        }\n        this.eventListeners.get(eventType).push(callback);\n    }\n\n    /**\n     * Remove event listener\n     * @param {string} eventType - Type of event\n     * @param {Function} callback - Callback function to remove\n     */\n    removeEventListener(eventType, callback) {\n        if (!this.eventListeners.has(eventType)) return;\n        \n        const listeners = this.eventListeners.get(eventType);\n        const index = listeners.indexOf(callback);\n        if (index > -1) {\n            listeners.splice(index, 1);\n        }\n    }\n\n    /**\n     * Emit story event to listeners\n     * @param {string} eventType - Type of event\n     * @param {*} data - Event data\n     */\n    emitStoryEvent(eventType, data) {\n        if (!this.eventListeners.has(eventType)) return;\n        \n        this.eventListeners.get(eventType).forEach(callback => {\n            try {\n                callback(data);\n            } catch (error) {\n                console.error(`Error in story event listener for ${eventType}:`, error);\n            }\n        });\n    }\n\n    /**\n     * Get current story state for saving\n     * @returns {Object} - Serializable story state\n     */\n    getStoryState() {\n        return {\n            currentCheckpoint: this.currentCheckpoint,\n            completedEvents: Array.from(this.completedEvents),\n            storyFlags: Object.fromEntries(this.storyFlags),\n            unlockedPowers: Array.from(this.unlockedPowers)\n        };\n    }\n\n    /**\n     * Load story state from save data\n     * @param {Object} storyState - Story state to load\n     */\n    loadStoryState(storyState) {\n        if (!storyState) return;\n\n        this.currentCheckpoint = storyState.currentCheckpoint || 'game_start';\n        this.completedEvents = new Set(storyState.completedEvents || []);\n        this.storyFlags = new Map(Object.entries(storyState.storyFlags || {}));\n        this.unlockedPowers = new Set(storyState.unlockedPowers || []);\n        \n        console.log('Story state loaded');\n    }\n\n    /**\n     * Reset story to initial state\n     */\n    resetStory() {\n        this.currentCheckpoint = 'game_start';\n        this.completedEvents.clear();\n        this.storyFlags.clear();\n        this.unlockedPowers.clear();\n        this.initializeStoryState();\n        \n        console.log('Story reset to initial state');\n    }\n\n    /**\n     * Get story progress information\n     * @returns {Object} - Progress information\n     */\n    getStoryProgress() {\n        const totalEvents = this.storyData ? this.storyData.events.length : 0;\n        const completedCount = this.completedEvents.size;\n        \n        return {\n            currentCheckpoint: this.currentCheckpoint,\n            completedEvents: completedCount,\n            totalEvents: totalEvents,\n            progressPercentage: totalEvents > 0 ? (completedCount / totalEvents) * 100 : 0,\n            unlockedPowers: this.getUnlockedPowers().length\n        };\n    }\n}","/**\n * PowerSystem - Manages character abilities and their integration with story progression\n * Handles power unlocking, activation, cooldowns, and visual feedback\n */\nexport default class PowerSystem {\n    constructor(scene) {\n        this.scene = scene;\n        this.powers = new Map();\n        this.unlockedPowers = new Set();\n        this.activePowers = new Map();\n        this.cooldowns = new Map();\n        this.eventListeners = new Map();\n        \n        // Initialize power definitions\n        this.initializePowerDefinitions();\n        \n        // Set up input controls for power activation\n        this.setupPowerControls();\n        \n        console.log('PowerSystem initialized');\n    }\n\n    /**\n     * Initialize power definitions with their properties and effects\n     */\n    initializePowerDefinitions() {\n        // Define available powers in the game\n        const powerDefinitions = [\n            {\n                id: 'telekinesis',\n                name: 'Telekinesis',\n                description: 'Move objects with your mind',\n                type: 'active',\n                cooldown: 3000, // 3 seconds\n                range: 64, // 2 tiles\n                effects: [\n                    { type: 'move_object', strength: 1 },\n                    { type: 'visual_effect', effect: 'telekinesis_glow' }\n                ],\n                unlockCondition: 'first_power_unlock',\n                activationKey: 'Q'\n            },\n            {\n                id: 'enhanced_vision',\n                name: 'Enhanced Vision',\n                description: 'See hidden objects and secrets',\n                type: 'toggle',\n                cooldown: 0,\n                range: 0,\n                effects: [\n                    { type: 'reveal_hidden', duration: -1 },\n                    { type: 'visual_effect', effect: 'vision_overlay' }\n                ],\n                unlockCondition: 'vision_power_unlock',\n                activationKey: 'E'\n            },\n            {\n                id: 'time_slow',\n                name: 'Time Slow',\n                description: 'Slow down time around you',\n                type: 'active',\n                cooldown: 10000, // 10 seconds\n                range: 0,\n                effects: [\n                    { type: 'time_manipulation', factor: 0.5, duration: 3000 },\n                    { type: 'visual_effect', effect: 'time_distortion' }\n                ],\n                unlockCondition: 'time_power_unlock',\n                activationKey: 'R'\n            },\n            {\n                id: 'phase_walk',\n                name: 'Phase Walk',\n                description: 'Walk through certain obstacles',\n                type: 'active',\n                cooldown: 8000, // 8 seconds\n                range: 0,\n                effects: [\n                    { type: 'phase_through', duration: 2000 },\n                    { type: 'visual_effect', effect: 'phase_glow' }\n                ],\n                unlockCondition: 'phase_power_unlock',\n                activationKey: 'F'\n            }\n        ];\n\n        // Store power definitions\n        powerDefinitions.forEach(power => {\n            this.powers.set(power.id, power);\n        });\n    }\n\n    /**\n     * Set up keyboard controls for power activation\n     */\n    setupPowerControls() {\n        if (!this.scene || !this.scene.input) return;\n\n        this.powerKeys = {};\n        \n        // Set up keys for each power\n        this.powers.forEach(power => {\n            if (power.activationKey) {\n                const keyCode = Phaser.Input.Keyboard.KeyCodes[power.activationKey];\n                if (keyCode) {\n                    this.powerKeys[power.id] = this.scene.input.keyboard.addKey(keyCode);\n                }\n            }\n        });\n\n        console.log('Power controls set up');\n    }\n\n    /**\n     * Unlock a power through story milestone triggers\n     * @param {string} powerId - ID of the power to unlock\n     * @param {string} storyTrigger - Story event that triggered the unlock\n     */\n    unlockPower(powerId, storyTrigger = null) {\n        if (!this.powers.has(powerId)) {\n            console.warn(`Power not found: ${powerId}`);\n            return false;\n        }\n\n        if (this.unlockedPowers.has(powerId)) {\n            console.log(`Power already unlocked: ${powerId}`);\n            return false;\n        }\n\n        const power = this.powers.get(powerId);\n        \n        // Add to unlocked powers\n        this.unlockedPowers.add(powerId);\n        \n        // Show unlock notification\n        this.showPowerUnlockNotification(power, storyTrigger);\n        \n        // Emit power unlock event\n        this.emitPowerEvent('power_unlocked', { powerId, power, storyTrigger });\n        \n        console.log(`Power unlocked: ${powerId} (triggered by: ${storyTrigger || 'unknown'})`);\n        return true;\n    }\n\n    /**\n     * Check if a power is available for use\n     * @param {string} powerId - ID of the power to check\n     * @returns {boolean} - Whether power can be activated\n     */\n    checkPowerAvailability(powerId) {\n        if (!this.unlockedPowers.has(powerId)) {\n            return false;\n        }\n\n        // Check if power is on cooldown\n        if (this.cooldowns.has(powerId)) {\n            const cooldownEnd = this.cooldowns.get(powerId);\n            if (Date.now() < cooldownEnd) {\n                return false;\n            } else {\n                // Cooldown expired, remove it\n                this.cooldowns.delete(powerId);\n            }\n        }\n\n        return true;\n    }\n\n    /**\n     * Activate a power with the specified context\n     * @param {string} powerId - ID of the power to activate\n     * @param {Object} context - Activation context (target, position, etc.)\n     * @returns {boolean} - Whether activation was successful\n     */\n    activatePower(powerId, context = {}) {\n        if (!this.checkPowerAvailability(powerId)) {\n            console.log(`Power not available: ${powerId}`);\n            return false;\n        }\n\n        const power = this.powers.get(powerId);\n        if (!power) {\n            console.warn(`Power not found: ${powerId}`);\n            return false;\n        }\n\n        // Set cooldown if applicable\n        if (power.cooldown > 0) {\n            this.cooldowns.set(powerId, Date.now() + power.cooldown);\n        }\n\n        // Handle different power types\n        switch (power.type) {\n            case 'active':\n                this.activateActivePower(power, context);\n                break;\n            case 'toggle':\n                this.togglePower(power, context);\n                break;\n            case 'passive':\n                // Passive powers are always active once unlocked\n                console.log(`Passive power ${powerId} is always active`);\n                break;\n            default:\n                console.warn(`Unknown power type: ${power.type}`);\n                return false;\n        }\n\n        // Show activation feedback\n        this.showPowerActivationFeedback(power, context);\n        \n        // Emit power activation event\n        this.emitPowerEvent('power_activated', { powerId, power, context });\n        \n        console.log(`Power activated: ${powerId}`);\n        return true;\n    }\n\n    /**\n     * Activate an active-type power\n     * @param {Object} power - Power definition\n     * @param {Object} context - Activation context\n     */\n    activateActivePower(power, context) {\n        // Apply power effects\n        power.effects.forEach(effect => {\n            this.applyPowerEffect(effect, power, context);\n        });\n\n        // Store active power with duration if applicable\n        const duration = power.effects.find(e => e.duration)?.duration || 1000;\n        if (duration > 0) {\n            this.activePowers.set(power.id, {\n                power,\n                context,\n                startTime: Date.now(),\n                duration\n            });\n\n            // Set timer to deactivate power\n            setTimeout(() => {\n                this.deactivatePower(power.id);\n            }, duration);\n        }\n    }\n\n    /**\n     * Toggle a toggle-type power on/off\n     * @param {Object} power - Power definition\n     * @param {Object} context - Activation context\n     */\n    togglePower(power, context) {\n        if (this.activePowers.has(power.id)) {\n            // Power is active, deactivate it\n            this.deactivatePower(power.id);\n        } else {\n            // Power is inactive, activate it\n            power.effects.forEach(effect => {\n                this.applyPowerEffect(effect, power, context);\n            });\n\n            this.activePowers.set(power.id, {\n                power,\n                context,\n                startTime: Date.now(),\n                duration: -1 // Indefinite duration\n            });\n        }\n    }\n\n    /**\n     * Deactivate a power\n     * @param {string} powerId - ID of the power to deactivate\n     */\n    deactivatePower(powerId) {\n        if (!this.activePowers.has(powerId)) {\n            return;\n        }\n\n        const activePower = this.activePowers.get(powerId);\n        const power = activePower.power;\n\n        // Remove power effects\n        power.effects.forEach(effect => {\n            this.removePowerEffect(effect, power, activePower.context);\n        });\n\n        this.activePowers.delete(powerId);\n        \n        // Emit power deactivation event\n        this.emitPowerEvent('power_deactivated', { powerId, power });\n        \n        console.log(`Power deactivated: ${powerId}`);\n    }\n\n    /**\n     * Apply a power effect\n     * @param {Object} effect - Effect definition\n     * @param {Object} power - Power definition\n     * @param {Object} context - Activation context\n     */\n    applyPowerEffect(effect, power, context) {\n        switch (effect.type) {\n            case 'move_object':\n                this.applyTelekinesisEffect(effect, power, context);\n                break;\n            case 'reveal_hidden':\n                this.applyVisionEffect(effect, power, context);\n                break;\n            case 'time_manipulation':\n                this.applyTimeEffect(effect, power, context);\n                break;\n            case 'phase_through':\n                this.applyPhaseEffect(effect, power, context);\n                break;\n            case 'visual_effect':\n                this.applyVisualEffect(effect, power, context);\n                break;\n            default:\n                console.warn(`Unknown effect type: ${effect.type}`);\n        }\n    }\n\n    /**\n     * Remove a power effect\n     * @param {Object} effect - Effect definition\n     * @param {Object} power - Power definition\n     * @param {Object} context - Activation context\n     */\n    removePowerEffect(effect, power, context) {\n        switch (effect.type) {\n            case 'reveal_hidden':\n                this.removeVisionEffect(effect, power, context);\n                break;\n            case 'time_manipulation':\n                this.removeTimeEffect(effect, power, context);\n                break;\n            case 'phase_through':\n                this.removePhaseEffect(effect, power, context);\n                break;\n            case 'visual_effect':\n                this.removeVisualEffect(effect, power, context);\n                break;\n        }\n    }\n\n    /**\n     * Apply telekinesis effect\n     */\n    applyTelekinesisEffect(effect, power, context) {\n        if (!this.scene.player) return;\n\n        const playerPos = this.scene.player.getPosition();\n        const range = power.range || 64;\n\n        // Create telekinesis visual effect\n        const telekinesisEffect = this.scene.add.circle(\n            playerPos.x + 16, \n            playerPos.y + 16, \n            range, \n            0x9b59b6, \n            0.3\n        );\n        telekinesisEffect.setStroke(2, 0x8e44ad);\n        telekinesisEffect.setDepth(1000);\n\n        // Animate the effect\n        this.scene.tweens.add({\n            targets: telekinesisEffect,\n            scaleX: 1.2,\n            scaleY: 1.2,\n            alpha: 0,\n            duration: 1000,\n            onComplete: () => telekinesisEffect.destroy()\n        });\n\n        console.log('Telekinesis effect applied');\n    }\n\n    /**\n     * Apply enhanced vision effect\n     */\n    applyVisionEffect(effect, power, context) {\n        // Create vision overlay\n        this.visionOverlay = this.scene.add.rectangle(\n            this.scene.cameras.main.centerX,\n            this.scene.cameras.main.centerY,\n            this.scene.cameras.main.width,\n            this.scene.cameras.main.height,\n            0x00ffff,\n            0.1\n        );\n        this.visionOverlay.setScrollFactor(0);\n        this.visionOverlay.setDepth(500);\n\n        console.log('Enhanced vision effect applied');\n    }\n\n    /**\n     * Remove enhanced vision effect\n     */\n    removeVisionEffect(effect, power, context) {\n        if (this.visionOverlay) {\n            this.visionOverlay.destroy();\n            this.visionOverlay = null;\n        }\n        console.log('Enhanced vision effect removed');\n    }\n\n    /**\n     * Apply time manipulation effect\n     */\n    applyTimeEffect(effect, power, context) {\n        if (this.scene.physics && this.scene.physics.world) {\n            // Slow down physics\n            this.originalTimeScale = this.scene.physics.world.timeScale;\n            this.scene.physics.world.timeScale = effect.factor || 0.5;\n        }\n\n        // Create time distortion visual effect\n        this.timeDistortionEffect = this.scene.add.rectangle(\n            this.scene.cameras.main.centerX,\n            this.scene.cameras.main.centerY,\n            this.scene.cameras.main.width,\n            this.scene.cameras.main.height,\n            0xffffff,\n            0.05\n        );\n        this.timeDistortionEffect.setScrollFactor(0);\n        this.timeDistortionEffect.setDepth(600);\n\n        console.log('Time manipulation effect applied');\n    }\n\n    /**\n     * Remove time manipulation effect\n     */\n    removeTimeEffect(effect, power, context) {\n        if (this.scene.physics && this.scene.physics.world && this.originalTimeScale !== undefined) {\n            this.scene.physics.world.timeScale = this.originalTimeScale;\n        }\n\n        if (this.timeDistortionEffect) {\n            this.timeDistortionEffect.destroy();\n            this.timeDistortionEffect = null;\n        }\n\n        console.log('Time manipulation effect removed');\n    }\n\n    /**\n     * Apply phase walk effect\n     */\n    applyPhaseEffect(effect, power, context) {\n        if (this.scene.player && this.scene.player.sprite) {\n            // Make player semi-transparent and able to phase through obstacles\n            this.scene.player.sprite.setAlpha(0.5);\n            this.scene.player.sprite.setTint(0x00ffff);\n            \n            // Set phase flag for collision detection\n            this.scene.player.isPhasing = true;\n        }\n\n        console.log('Phase walk effect applied');\n    }\n\n    /**\n     * Remove phase walk effect\n     */\n    removePhaseEffect(effect, power, context) {\n        if (this.scene.player && this.scene.player.sprite) {\n            this.scene.player.sprite.setAlpha(1);\n            this.scene.player.sprite.clearTint();\n            this.scene.player.isPhasing = false;\n        }\n\n        console.log('Phase walk effect removed');\n    }\n\n    /**\n     * Apply visual effect\n     */\n    applyVisualEffect(effect, power, context) {\n        const effectName = effect.effect;\n        \n        switch (effectName) {\n            case 'telekinesis_glow':\n                this.createGlowEffect(0x9b59b6);\n                break;\n            case 'vision_overlay':\n                // Already handled in applyVisionEffect\n                break;\n            case 'time_distortion':\n                // Already handled in applyTimeEffect\n                break;\n            case 'phase_glow':\n                this.createGlowEffect(0x00ffff);\n                break;\n        }\n    }\n\n    /**\n     * Remove visual effect\n     */\n    removeVisualEffect(effect, power, context) {\n        // Visual effects are typically temporary and self-cleaning\n    }\n\n    /**\n     * Create a glow effect around the player\n     */\n    createGlowEffect(color) {\n        if (!this.scene.player) return;\n\n        const playerPos = this.scene.player.getPosition();\n        const glow = this.scene.add.circle(\n            playerPos.x + 16,\n            playerPos.y + 16,\n            20,\n            color,\n            0.4\n        );\n        glow.setDepth(this.scene.player.sprite.depth - 1);\n\n        this.scene.tweens.add({\n            targets: glow,\n            scaleX: 1.5,\n            scaleY: 1.5,\n            alpha: 0,\n            duration: 800,\n            onComplete: () => glow.destroy()\n        });\n    }\n\n    /**\n     * Update power system (called from scene update loop)\n     * @param {number} time - Current time\n     * @param {number} delta - Time delta\n     */\n    update(time, delta) {\n        // Handle power input\n        this.handlePowerInput();\n        \n        // Update active powers\n        this.updateActivePowers(time, delta);\n        \n        // Update cooldown displays\n        this.updateCooldownDisplays();\n    }\n\n    /**\n     * Handle power activation input\n     */\n    handlePowerInput() {\n        if (!this.powerKeys) return;\n\n        this.powers.forEach((power, powerId) => {\n            const key = this.powerKeys[powerId];\n            if (key && Phaser.Input.Keyboard.JustDown(key)) {\n                this.activatePower(powerId);\n            }\n        });\n    }\n\n    /**\n     * Update active powers\n     */\n    updateActivePowers(time, delta) {\n        this.activePowers.forEach((activePower, powerId) => {\n            if (activePower.duration > 0) {\n                const elapsed = time - activePower.startTime;\n                if (elapsed >= activePower.duration) {\n                    this.deactivatePower(powerId);\n                }\n            }\n        });\n    }\n\n    /**\n     * Update cooldown displays\n     */\n    updateCooldownDisplays() {\n        // This would update UI elements showing cooldown status\n        // Implementation depends on UI system\n    }\n\n    /**\n     * Show power unlock notification\n     * @param {Object} power - Power that was unlocked\n     * @param {string} storyTrigger - Story trigger that caused unlock\n     */\n    showPowerUnlockNotification(power, storyTrigger) {\n        if (!this.scene) return;\n\n        const notification = this.scene.add.container(\n            this.scene.cameras.main.centerX,\n            this.scene.cameras.main.centerY - 100\n        );\n        notification.setScrollFactor(0);\n        notification.setDepth(5000);\n\n        // Background\n        const bg = this.scene.add.rectangle(0, 0, 400, 120, 0x2c3e50, 0.9);\n        bg.setStroke(3, 0xf39c12);\n\n        // Title\n        const title = this.scene.add.text(0, -30, 'NEW POWER UNLOCKED!', {\n            fontSize: '20px',\n            fontFamily: 'Arial',\n            color: '#f39c12',\n            fontStyle: 'bold'\n        });\n        title.setOrigin(0.5);\n\n        // Power name\n        const powerName = this.scene.add.text(0, 0, power.name, {\n            fontSize: '24px',\n            fontFamily: 'Arial',\n            color: '#ecf0f1',\n            fontStyle: 'bold'\n        });\n        powerName.setOrigin(0.5);\n\n        // Description\n        const description = this.scene.add.text(0, 25, power.description, {\n            fontSize: '14px',\n            fontFamily: 'Arial',\n            color: '#bdc3c7'\n        });\n        description.setOrigin(0.5);\n\n        // Activation key\n        const keyHint = this.scene.add.text(0, 45, `Press ${power.activationKey} to use`, {\n            fontSize: '12px',\n            fontFamily: 'Arial',\n            color: '#95a5a6'\n        });\n        keyHint.setOrigin(0.5);\n\n        notification.add([bg, title, powerName, description, keyHint]);\n\n        // Animate notification\n        notification.setScale(0);\n        this.scene.tweens.add({\n            targets: notification,\n            scaleX: 1,\n            scaleY: 1,\n            duration: 500,\n            ease: 'Back.easeOut',\n            onComplete: () => {\n                this.scene.tweens.add({\n                    targets: notification,\n                    alpha: 0,\n                    duration: 1000,\n                    delay: 3000,\n                    onComplete: () => notification.destroy()\n                });\n            }\n        });\n    }\n\n    /**\n     * Show power activation feedback\n     * @param {Object} power - Power that was activated\n     * @param {Object} context - Activation context\n     */\n    showPowerActivationFeedback(power, context) {\n        if (!this.scene) return;\n\n        // Show power name briefly\n        const feedback = this.scene.add.text(\n            this.scene.cameras.main.centerX,\n            this.scene.cameras.main.centerY + 150,\n            power.name,\n            {\n                fontSize: '18px',\n                fontFamily: 'Arial',\n                color: '#f39c12',\n                backgroundColor: 'rgba(0,0,0,0.7)',\n                padding: { x: 10, y: 5 }\n            }\n        );\n        feedback.setOrigin(0.5);\n        feedback.setScrollFactor(0);\n        feedback.setDepth(4000);\n\n        this.scene.tweens.add({\n            targets: feedback,\n            alpha: 0,\n            y: feedback.y - 30,\n            duration: 1500,\n            onComplete: () => feedback.destroy()\n        });\n    }\n\n    /**\n     * Get list of all available powers\n     * @returns {Array} - Array of power objects\n     */\n    getPowerList() {\n        return Array.from(this.powers.values());\n    }\n\n    /**\n     * Get list of unlocked powers\n     * @returns {Array} - Array of unlocked power objects\n     */\n    getUnlockedPowerList() {\n        return Array.from(this.unlockedPowers).map(powerId => this.powers.get(powerId));\n    }\n\n    /**\n     * Get power by ID\n     * @param {string} powerId - Power ID\n     * @returns {Object|null} - Power object or null\n     */\n    getPower(powerId) {\n        return this.powers.get(powerId) || null;\n    }\n\n    /**\n     * Check if power is currently active\n     * @param {string} powerId - Power ID\n     * @returns {boolean} - Whether power is active\n     */\n    isPowerActive(powerId) {\n        return this.activePowers.has(powerId);\n    }\n\n    /**\n     * Get remaining cooldown time for a power\n     * @param {string} powerId - Power ID\n     * @returns {number} - Remaining cooldown in milliseconds\n     */\n    getRemainingCooldown(powerId) {\n        if (!this.cooldowns.has(powerId)) {\n            return 0;\n        }\n\n        const cooldownEnd = this.cooldowns.get(powerId);\n        const remaining = cooldownEnd - Date.now();\n        return Math.max(0, remaining);\n    }\n\n    /**\n     * Add event listener for power events\n     * @param {string} eventType - Type of event to listen for\n     * @param {Function} callback - Callback function\n     */\n    addEventListener(eventType, callback) {\n        if (!this.eventListeners.has(eventType)) {\n            this.eventListeners.set(eventType, []);\n        }\n        this.eventListeners.get(eventType).push(callback);\n    }\n\n    /**\n     * Remove event listener\n     * @param {string} eventType - Type of event\n     * @param {Function} callback - Callback function to remove\n     */\n    removeEventListener(eventType, callback) {\n        if (!this.eventListeners.has(eventType)) return;\n        \n        const listeners = this.eventListeners.get(eventType);\n        const index = listeners.indexOf(callback);\n        if (index > -1) {\n            listeners.splice(index, 1);\n        }\n    }\n\n    /**\n     * Emit power event to listeners\n     * @param {string} eventType - Type of event\n     * @param {*} data - Event data\n     */\n    emitPowerEvent(eventType, data) {\n        if (!this.eventListeners.has(eventType)) return;\n        \n        this.eventListeners.get(eventType).forEach(callback => {\n            try {\n                callback(data);\n            } catch (error) {\n                console.error(`Error in power event listener for ${eventType}:`, error);\n            }\n        });\n    }\n\n    /**\n     * Get power system state for saving\n     * @returns {Object} - Serializable power system state\n     */\n    getPowerSystemState() {\n        return {\n            unlockedPowers: Array.from(this.unlockedPowers),\n            activePowers: Array.from(this.activePowers.keys()),\n            cooldowns: Object.fromEntries(this.cooldowns)\n        };\n    }\n\n    /**\n     * Load power system state from save data\n     * @param {Object} powerState - Power system state to load\n     */\n    loadPowerSystemState(powerState) {\n        if (!powerState) return;\n\n        this.unlockedPowers = new Set(powerState.unlockedPowers || []);\n        this.cooldowns = new Map(Object.entries(powerState.cooldowns || {}));\n        \n        // Note: Active powers are not restored on load as they are temporary\n        this.activePowers.clear();\n        \n        console.log('Power system state loaded');\n    }\n\n    /**\n     * Reset power system to initial state\n     */\n    resetPowerSystem() {\n        this.unlockedPowers.clear();\n        this.activePowers.clear();\n        this.cooldowns.clear();\n        \n        console.log('Power system reset to initial state');\n    }\n\n    /**\n     * Destroy power system and clean up resources\n     */\n    destroy() {\n        // Deactivate all powers\n        this.activePowers.forEach((_, powerId) => {\n            this.deactivatePower(powerId);\n        });\n\n        // Clear all data\n        this.powers.clear();\n        this.unlockedPowers.clear();\n        this.activePowers.clear();\n        this.cooldowns.clear();\n        this.eventListeners.clear();\n\n        // Clean up input\n        this.powerKeys = null;\n\n        console.log('PowerSystem destroyed');\n    }\n}","import StorySystem from '../systems/StorySystem.js';\nimport PowerSystem from '../systems/PowerSystem.js';\n\n/**\n * GameManager Plugin - Manages overall game state and coordinates systems\n */\nexport default class GameManager extends Phaser.Plugins.BasePlugin {\n    constructor(pluginManager) {\n        super(pluginManager);\n        this.storySystem = null;\n        this.powerSystem = null;\n        this.gameState = {\n            initialized: false,\n            currentScene: null\n        };\n    }\n\n    /**\n     * Initialize the GameManager\n     */\n    init() {\n        console.log('GameManager initialized');\n    }\n\n    /**\n     * Start the GameManager and initialize systems\n     */\n    start() {\n        console.log('GameManager started');\n        this.initializeSystems();\n    }\n\n    /**\n     * Initialize game systems\n     */\n    initializeSystems() {\n        const gameWorldScene = this.game.scene.getScene('GameWorldScene');\n        \n        // Initialize StorySystem\n        this.storySystem = new StorySystem(gameWorldScene);\n        \n        // Initialize PowerSystem\n        this.powerSystem = new PowerSystem(gameWorldScene);\n        \n        // Set up integration between systems\n        this.setupSystemIntegration();\n        \n        // Load story data\n        this.loadStoryData();\n        \n        this.gameState.initialized = true;\n        console.log('Game systems initialized');\n    }\n\n    /**\n     * Set up integration between different game systems\n     */\n    setupSystemIntegration() {\n        if (!this.storySystem || !this.powerSystem) return;\n\n        // Listen for story events that should unlock powers\n        this.storySystem.addEventListener('power_unlocked', (data) => {\n            this.powerSystem.unlockPower(data.powerId, 'story_progression');\n        });\n\n        // Listen for power activations that might trigger story events\n        this.powerSystem.addEventListener('power_activated', (data) => {\n            // Check if power activation should trigger story events\n            this.checkPowerStoryTriggers(data.powerId, data.context);\n        });\n\n        console.log('System integration set up');\n    }\n\n    /**\n     * Check if power activation should trigger story events\n     * @param {string} powerId - ID of activated power\n     * @param {Object} context - Activation context\n     */\n    checkPowerStoryTriggers(powerId, context) {\n        // Define power-to-story mappings\n        const powerStoryTriggers = {\n            'telekinesis': 'first_telekinesis_use',\n            'enhanced_vision': 'first_vision_use',\n            'time_slow': 'first_time_manipulation',\n            'phase_walk': 'first_phase_walk'\n        };\n\n        const storyEvent = powerStoryTriggers[powerId];\n        if (storyEvent) {\n            this.storySystem.triggerStoryEvent(storyEvent);\n        }\n    }\n\n    /**\n     * Load story data\n     */\n    async loadStoryData() {\n        try {\n            const success = await this.storySystem.loadStoryData('./src/assets/story/main-story.json');\n            if (success) {\n                console.log('Story data loaded successfully');\n                // Trigger initial story event\n                this.storySystem.triggerStoryEvent('game_start');\n            } else {\n                console.warn('Failed to load story data, using fallback');\n            }\n        } catch (error) {\n            console.error('Error loading story data:', error);\n        }\n    }\n\n    /**\n     * Get the story system instance\n     * @returns {StorySystem} - Story system instance\n     */\n    getStorySystem() {\n        return this.storySystem;\n    }\n\n    /**\n     * Get the power system instance\n     * @returns {PowerSystem} - Power system instance\n     */\n    getPowerSystem() {\n        return this.powerSystem;\n    }\n\n    /**\n     * Save game state\n     * @returns {Object} - Serialized game state\n     */\n    saveGame() {\n        if (!this.storySystem || !this.powerSystem) {\n            console.warn('Cannot save game: Systems not initialized');\n            return null;\n        }\n\n        const gameState = {\n            timestamp: Date.now(),\n            story: this.storySystem.getStoryState(),\n            powers: this.powerSystem.getPowerSystemState(),\n            gameVersion: '1.0.0'\n        };\n\n        try {\n            localStorage.setItem('rpg_save_data', JSON.stringify(gameState));\n            console.log('Game saved successfully');\n            return gameState;\n        } catch (error) {\n            console.error('Error saving game:', error);\n            return null;\n        }\n    }\n\n    /**\n     * Load game state\n     * @returns {boolean} - Success status\n     */\n    loadGame() {\n        try {\n            const saveData = localStorage.getItem('rpg_save_data');\n            if (!saveData) {\n                console.log('No save data found');\n                return false;\n            }\n\n            const gameState = JSON.parse(saveData);\n            \n            if (!this.storySystem || !this.powerSystem) {\n                console.warn('Cannot load game: Systems not initialized');\n                return false;\n            }\n\n            // Load story state\n            this.storySystem.loadStoryState(gameState.story);\n            \n            // Load power system state\n            if (gameState.powers) {\n                this.powerSystem.loadPowerSystemState(gameState.powers);\n            }\n            \n            console.log('Game loaded successfully');\n            return true;\n        } catch (error) {\n            console.error('Error loading game:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Get current game state\n     * @returns {Object} - Current game state\n     */\n    getGameState() {\n        return {\n            ...this.gameState,\n            story: this.storySystem ? this.storySystem.getStoryProgress() : null\n        };\n    }\n\n    /**\n     * Reset game to initial state\n     */\n    resetGame() {\n        if (this.storySystem) {\n            this.storySystem.resetStory();\n        }\n        \n        if (this.powerSystem) {\n            this.powerSystem.resetPowerSystem();\n        }\n        \n        // Clear save data\n        localStorage.removeItem('rpg_save_data');\n        \n        console.log('Game reset to initial state');\n    }\n}","import Phaser from 'phaser';\nimport MainMenuScene from './scenes/MainMenuScene.js';\nimport GameWorldScene from './scenes/GameWorldScene.js';\nimport DialogueScene from './scenes/DialogueScene.js';\nimport InventoryScene from './scenes/InventoryScene.js';\nimport GameManager from './managers/GameManager.js';\n\n// Game configuration\nconst config = {\n    type: Phaser.AUTO,\n    width: 800,\n    height: 600,\n    parent: 'game-container',\n    backgroundColor: '#2c3e50',\n    physics: {\n        default: 'arcade',\n        arcade: {\n            gravity: { y: 0 },\n            debug: false\n        }\n    },\n    scene: [\n        MainMenuScene,\n        GameWorldScene,\n        DialogueScene,\n        InventoryScene\n    ],\n    plugins: {\n        global: [\n            {\n                key: 'GameManager',\n                plugin: GameManager,\n                start: true\n            }\n        ]\n    },\n    scale: {\n        mode: Phaser.Scale.FIT,\n        autoCenter: Phaser.Scale.CENTER_BOTH\n    }\n};\n\n// Initialize the game\nconst game = new Phaser.Game(config);\n\n// Export game instance for debugging\nwindow.game = game;","/**\n * Test script for PowerSystem functionality\n * Run this in the browser console to test power system features\n */\n\n// Test PowerSystem functionality\nfunction testPowerSystem() {\n    console.log('=== Testing PowerSystem ===');\n    \n    // Get game instance\n    const game = window.game;\n    if (!game) {\n        console.error('Game instance not found');\n        return;\n    }\n    \n    // Get GameManager\n    const gameManager = game.plugins.get('GameManager');\n    if (!gameManager) {\n        console.error('GameManager not found');\n        return;\n    }\n    \n    // Get PowerSystem\n    const powerSystem = gameManager.getPowerSystem();\n    if (!powerSystem) {\n        console.error('PowerSystem not found');\n        return;\n    }\n    \n    console.log('PowerSystem found:', powerSystem);\n    \n    // Test 1: Check initial state\n    console.log('\\n--- Test 1: Initial State ---');\n    console.log('Available powers:', powerSystem.getPowerList().map(p => p.id));\n    console.log('Unlocked powers:', powerSystem.getUnlockedPowerList().map(p => p.id));\n    \n    // Test 2: Unlock a power\n    console.log('\\n--- Test 2: Unlock Telekinesis ---');\n    const unlockResult = powerSystem.unlockPower('telekinesis', 'test_trigger');\n    console.log('Unlock result:', unlockResult);\n    console.log('Unlocked powers after unlock:', powerSystem.getUnlockedPowerList().map(p => p.id));\n    \n    // Test 3: Check power availability\n    console.log('\\n--- Test 3: Check Power Availability ---');\n    console.log('Can use telekinesis:', powerSystem.checkPowerAvailability('telekinesis'));\n    console.log('Can use enhanced_vision:', powerSystem.checkPowerAvailability('enhanced_vision'));\n    \n    // Test 4: Activate power\n    console.log('\\n--- Test 4: Activate Telekinesis ---');\n    const activateResult = powerSystem.activatePower('telekinesis', { test: true });\n    console.log('Activation result:', activateResult);\n    console.log('Is telekinesis active:', powerSystem.isPowerActive('telekinesis'));\n    console.log('Remaining cooldown:', powerSystem.getRemainingCooldown('telekinesis'));\n    \n    // Test 5: Try to activate power on cooldown\n    setTimeout(() => {\n        console.log('\\n--- Test 5: Try Activation During Cooldown ---');\n        const cooldownResult = powerSystem.activatePower('telekinesis', { test: true });\n        console.log('Activation during cooldown result:', cooldownResult);\n        console.log('Remaining cooldown:', powerSystem.getRemainingCooldown('telekinesis'));\n    }, 1000);\n    \n    // Test 6: Test story integration\n    console.log('\\n--- Test 6: Story Integration ---');\n    const storySystem = gameManager.getStorySystem();\n    if (storySystem) {\n        console.log('Story system found, testing power unlock through story');\n        storySystem.unlockPower('enhanced_vision');\n        console.log('Powers after story unlock:', powerSystem.getUnlockedPowerList().map(p => p.id));\n    }\n    \n    console.log('\\n=== PowerSystem Test Complete ===');\n}\n\n// Test StorySystem integration with PowerSystem\nfunction testStoryPowerIntegration() {\n    console.log('=== Testing Story-Power Integration ===');\n    \n    const game = window.game;\n    const gameManager = game?.plugins.get('GameManager');\n    const storySystem = gameManager?.getStorySystem();\n    const powerSystem = gameManager?.getPowerSystem();\n    \n    if (!storySystem || !powerSystem) {\n        console.error('Required systems not found');\n        return;\n    }\n    \n    // Test story event that unlocks power\n    console.log('Triggering first_power_unlock story event...');\n    const event = storySystem.triggerStoryEvent('first_power_unlock');\n    console.log('Story event result:', event);\n    \n    // Check if power was unlocked\n    setTimeout(() => {\n        console.log('Powers after story event:', powerSystem.getUnlockedPowerList().map(p => p.id));\n    }, 500);\n    \n    console.log('=== Story-Power Integration Test Complete ===');\n}\n\n// Export test functions for browser console use\nwindow.testPowerSystem = testPowerSystem;\nwindow.testStoryPowerIntegration = testStoryPowerIntegration;\n\nconsole.log('Power system test functions loaded. Use testPowerSystem() or testStoryPowerIntegration() in console.');"],"names":["MainMenuScene","startButton","startButtonText","Character","scene","x","y","charGraphics","time","delta","velocityX","velocityY","newFacingDirection","deltaSeconds","newX","newY","collision","worldBounds","gridX","gridY","tints","currentTintIndex","direction","isPressed","powerId","context","gameManager","powerSystem","powerContext","target","GameWorldScene","grassGraphics","stoneGraphics","waterGraphics","treeGraphics","tileType","tileX","tileY","tileSprite","targetLayer","world","startX","startY","healthBg","healthBar","instructions","zone","transitionZone","indicator","playerPos","playerGridX","playerGridY","zoneGridX","zoneGridY","targetArea","transitionText","data","eventData","dialogueEvent","progress","checkpoint","testInstructions","notification","checkpointId","events","randomEvent","dialogueEvents","randomDialogue","event","currentFlag","powerInstructions","unlockedPowers","powerTexts","power","cooldown","isActive","status","feedback","DialogueScene","boxGraphics","speakerGraphics","choiceGraphics","choiceHoverGraphics","arrowGraphics","boxY","dialogueData","previousScene","text","speaker","nextEvent","choices","spacing","choice","index","button","effect","sys","InventoryScene","StorySystem","storyFile","response","error","eventId","e","conditions","condition","flag","value","oldValue","eventType","callback","listeners","storyState","totalEvents","completedCount","PowerSystem","keyCode","storyTrigger","cooldownEnd","duration","_a","activePower","range","telekinesisEffect","color","glow","key","bg","title","powerName","description","keyHint","remaining","powerState","_","GameManager","pluginManager","gameWorldScene","storyEvent","gameState","saveData","config","Phaser","game","testPowerSystem","p","unlockResult","activateResult","cooldownResult","storySystem","testStoryPowerIntegration"],"mappings":"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"}